<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Classes - Ashuthosh Classes</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
<style>
body { font-family:'Poppins',sans-serif; background:#f7f9fc; margin:0; padding:0; }
header.site-header { background:#2c3e50; color:white; padding:20px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap;}
.logo { font-size:1.6rem; font-weight:600; }
nav.main-nav { display:flex; gap:15px; flex-wrap:wrap;}
nav.main-nav a { color:white; text-decoration:none; font-weight:500;}
nav.main-nav a:hover { text-decoration:underline;}
.classes-section { padding:50px 20px; max-width:800px; margin:0 auto; text-align:center;}
.btn { padding:15px 30px; font-size:1.1rem; border:none; border-radius:8px; cursor:pointer; margin:10px;}
.btn-start { background:#2c3e50; color:white;}
.btn-join { background:#10b981; color:white;}
input, file { padding:10px; width:80%; border-radius:6px; border:1px solid #2c3e50; margin-bottom:10px; }
p.note { font-size:1rem; color:#333; margin-top:15px; }
.code-display { margin-top:15px; font-weight:600; color:#2c3e50; font-size:1.1rem; }
.code-display a { color:#10b981; text-decoration:none; font-weight:600; }
.code-display a:hover { text-decoration:underline; }
.upload-section { margin-top:40px; border-top:2px dashed #2c3e50; padding-top:30px; }
</style>
</head>
<body>

<header class="site-header">
  <div class="logo">Ashuthosh Classes</div>
  <nav class="main-nav">
    <a href="index.html">Home</a>
    <a href="classes.html">Classes</a>
    <a href="notes.html">Notes</a>
    <a href="register.html">Register</a>
    <a href="contact.html">Contact</a>
  </nav>
</header>

<section class="classes-section">
  <h1>Live & Recorded Classes</h1>

  <!-- Admin controls -->
  <div id="adminControls" style="display:none;">
    <button id="startMeetingBtn" class="btn btn-start">Start Meeting</button>
    <div>
      <input type="text" id="meetCodeInput" placeholder="Enter Google Meet code here">
      <button id="saveCodeBtn" class="btn btn-start">Save Code</button>
      <p class="note">After starting the meeting on Google Meet, enter the code here for students.</p>
    </div>

    <!-- Upload recorded meeting -->
    <div class="upload-section">
      <h2>Upload Recorded Meeting</h2>
      <input type="file" id="recordedFile" />
      <button id="uploadBtn" class="btn btn-start">Upload</button>
      <p class="note">Uploaded recordings will be available only to allowed students.</p>
    </div>
  </div>

  <!-- Student controls -->
  <div id="studentControls" style="display:none;">
    <p class="note">Click the link below to join the meeting:</p>
    <p class="code-display" id="studentMeetCode">
      <!-- Meeting link will appear here -->
    </p>

    <!-- Section to show uploaded recordings -->
    <div class="upload-section">
      <h2>Recorded Meetings</h2>
      <ul id="recordedList"></ul>
    </div>
  </div>
</section>

<footer class="site-footer">
  <p>&copy; 2025 Ashuthosh Classes. All rights reserved.</p>
</footer>

<script>
// Admin email
const adminEmail = "ashuthoshkrishna944@gmail.com";

// Get user email
let userEmail = localStorage.getItem("userEmail");
if(!userEmail){
  userEmail = prompt("Enter your email to continue:");
  localStorage.setItem("userEmail", userEmail);
}

// Load authorized users from users.json
fetch('users.json')
  .then(res => res.json())
  .then(allowedStudents => {
    if(userEmail === adminEmail){
      document.getElementById("adminControls").style.display = "block";
    } else if(allowedStudents.includes(userEmail)){
      document.getElementById("studentControls").style.display = "block";

      // Show link if already saved
      const savedCode = localStorage.getItem("currentMeetCode");
      if(savedCode) showMeetingLink(savedCode);

      // Show uploaded recordings
      const files = JSON.parse(localStorage.getItem("recordedFiles") || "[]");
      const list = document.getElementById("recordedList");
      files.forEach(f => {
        const li = document.createElement("li");
        li.innerHTML = `<a href="${f.url}" target="_blank">${f.name}</a>`;
        list.appendChild(li);
      });

    } else {
      alert("You are not allowed to join classes. Contact admin.");
      window.location.href = "login.html";
    }
  })
  .catch(err => {
    alert("Error loading authorized users. Contact admin.");
    console.error(err);
  });

// Admin starts meeting
document.getElementById("startMeetingBtn")?.addEventListener('click', () => {
  window.open("https://meet.google.com", "_blank");
});

// Admin saves meeting code
document.getElementById("saveCodeBtn")?.addEventListener('click', () => {
  const code = document.getElementById("meetCodeInput").value.trim();
  if(code){
    localStorage.setItem("currentMeetCode", code);
    alert("Meeting code saved! Students can now join.");
    document.getElementById("meetCodeInput").value = "";
    showMeetingLink(code);
  } else {
    alert("Please enter a valid Meet code.");
  }
});

// Function to show clickable meeting link
function showMeetingLink(code){
  const studentMeetEl = document.getElementById("studentMeetCode");
  const meetURL = "https://meet.google.com/" + code;
  studentMeetEl.innerHTML = `<a href="${meetURL}" target="_blank">${meetURL}</a>`;
}

// Admin uploads recording
document.getElementById("uploadBtn")?.addEventListener('click', () => {
  const fileInput = document.getElementById("recordedFile");
  if(fileInput.files.length === 0){
    alert("Please select a file to upload.");
    return;
  }
  const file = fileInput.files[0];
  const files = JSON.parse(localStorage.getItem("recordedFiles") || "[]");
  const fileURL = URL.createObjectURL(file);
  files.push({name: file.name, url: fileURL});
  localStorage.setItem("recordedFiles", JSON.stringify(files));
  alert("Recording uploaded! Students can now see it.");
  fileInput.value = "";
});
</script>

</body>
</html>
